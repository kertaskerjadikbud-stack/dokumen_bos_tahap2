<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitoring Aset BOS</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{background:#f1f5f9}
th,td{border:1px solid #e5e7eb;padding:4px;font-size:11px}
thead th{background:#001f3f;color:white;font-size:10px}
</style>
</head>

<body class="p-4">

<h1 class="text-center font-bold text-xl mb-4">
ðŸ“Š MONITORING BELANJA MODAL BOS 2025
</h1>

<div class="flex gap-3 mb-4">
  <input id="searchInput" onkeyup="updateTable()"
    class="border px-3 py-2 flex-1 rounded"
    placeholder="Cari Kecamatan / Sekolah">

  <select id="filterJenjang" onchange="loadData()" class="border px-3 py-2 rounded">
    <option value="ALL">Semua Jenjang</option>
    <option value="SD">SD</option>
    <option value="SMP">SMP</option>
  </select>

  <button onclick="exportExcel()" class="bg-emerald-600 text-white px-4 rounded">
    Excel
  </button>
</div>

<div class="bg-white overflow-auto rounded shadow">
<table id="mainTable" class="w-full">
<thead>
<tr>
<th rowspan="2">No</th>
<th rowspan="2">Kecamatan</th>
<th rowspan="2">Sekolah</th>
<th colspan="3">Rekap BOS</th>
<th rowspan="2">Selisih</th>
</tr>
<tr>
<th>Peralatan</th>
<th>Aset Lain</th>
<th>Total</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbxL6KO3pwqmHlxrsWfXa_IQ-h154Kv6DTJZAKYcAEirp8G5TBYnzxehz8kk0v4XzgIe/exec";
let masterData=[];

const rupiah=v=>new Intl.NumberFormat('id-ID',{
  style:'currency',currency:'IDR',minimumFractionDigits:0
}).format(v||0);

async function loadData(){
  const jenjang=document.getElementById('filterJenjang').value;
  const res=await fetch(`${SCRIPT_URL}?jenjang=${jenjang}`);
  const json=await res.json();
  masterData=json.slice(4);
  updateTable();
}

function updateTable(){
  const q=document.getElementById('searchInput').value.toLowerCase();
  const body=document.getElementById('tableBody');
  body.innerHTML="";
  let no=1;

  masterData.filter(r=>{
    return (r[0]+" "+r[1]).toLowerCase().includes(q);
  }).forEach(r=>{
    const tr=document.createElement('tr');
    const sel=r[4]-r[10];

    [
      no++,r[0],r[1],
      rupiah(r[2]),rupiah(r[3]),rupiah(r[4]),
      rupiah(sel)
    ].forEach((v,i)=>{
      const td=document.createElement('td');
      td.textContent=v;
      if(i===6) td.className=sel!==0?'text-red-600 font-bold':'text-emerald-600';
      tr.appendChild(td);
    });

    body.appendChild(tr);
  });
}

function exportExcel(){
  const wb=XLSX.utils.table_to_book(mainTable,{sheet:"Monitoring BOS"});
  XLSX.writeFile(wb,"Monitoring_BOS_2025.xlsx");
}

window.onload=loadData;
</script>

</body>
</html>
